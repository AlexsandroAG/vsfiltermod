#summary Документация по KaraHelper.
#labels Featured,Phase-Deploy

= Что это? =

KaraHelper — специальный Lua модуль расширяющий возможности автоматизации в Aegisub. Он предоставляет несколько новый функций, позволяющих работать с отрисованными субтитрами.

= Установка =

Скопируйте содержимое архива в папку автоматизации Aegisub. KaraHelper’у требуется как минимум один работающий csri-сервер, находящийся в папке Aegisub\csri (в стандартной поставке Aegisub там уже есть один). Чтобы использовать функции KaraHelper’а необходимо добавить _include("karahelper.lua")_ в начало вашего скрипта.

= Функции =

 _*text_table = karahelper.text_extents(style, text)*_
 
Аргументы:
 * _style_ — стандартная таблица стиля Aegisub;
 * _text_ — текст, который будет отрисовываться.
Возвращает таблицу со следующими полями:
 * _width_;
 * _height_;
 * _ascent_;
 * _descent_;
 * _extlead_;
 * _offsetx_.
Первые пять полей аналогичны возвращаемым значениям функции _aegisub.text_extents_, однако следуем учитывать, что значения, возвращаемые _karahelper.text_extents_, могут отличаться от значений, возвращаемых _aegisub.text_extents_. Последнее поле возвращаемой таблицы (_offsetx_) — смещение отрисованного текста вправо так, чтобы он соответствовал ширине (учитываются теги _`\`blur_ и _`\`be_). поэтому результирующая позиция должна вычисляться как _x - text_table.offsetx_.

 _*draw_text_str = karahelper.text_outline(style, text)*_

Аргументы аналогичны предыдущей функции. Функция возвращает строку, содержащую команды рисования (_`\`p_), которые образуют отрисованный текст. Не учитываются никакие теги. Ввиду того, что для рисования можно использовать только целочисленные значения, результат может быть угловатым. Поэтому перед использованием функции рекомендуется увеличить размер шрифта, а результат соответственно уменьшить.

 _*rendered_text = karahelper.render(style, text)*_

Аргументы аналогичны предыдущей функции. Возвращает таблицу со следующими полями:
 * _width_;
 * _height_;
 * _offsetx_;
 * _color`[`x`][`y`]`_;
 * _alpha`[`x`][`y`]`_.
Результат представляет из себя массив точек, формирующих отрисованный текст. Значения _width_, _height_, _offsetx_ такие же, как и у значений, возвращаемых функцией _karahelper.text_extents_. Поддерживаются только теги _`\`blur_ или _`\`be_. После окочания работы с полученной таблицей крайне рекомендуется освободить занятую ей память выполнив _rendered_text = nil_.

 _*rendered_img = karahelper.loadpng(filename)*_

Работает аналогично предыдущей функции за исключением того, что в качестве параметра принимает изображение. Возвращаемая таблица аналогична результату _karahelper.render_.

= Примеры =

Примеры использования функции вы можете найти в архиве с KaraHelper на странице загрузок.